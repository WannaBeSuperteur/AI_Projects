
* EffiSegNet Improved Implementation
  * EffiSegNet Base Implementation is from [Official PyTorch Implementation](https://github.com/ivezakis/effisegnet/tree/main)

## ëª©ì°¨

* [1. TEST RESULT](#1-test-result)
* [2. ë³€ê²½ì  ìƒì„¸](#2-ë³€ê²½ì -ìƒì„¸)
  * [2-1. ğŸ“ˆ ColorJitter & Affine Prob ìƒí–¥](#2-1--colorjitter--affine-prob-ìƒí–¥) 
  * [2-2. âœ‚ Remove ElasticTransform](#2-2--remove-elastictransform)
  * [2-3. ğŸŒ¬ Weaken ColorJitter](#2-3--weaken-colorjitter)
  * [2-4. ğŸ“ Inference Prediction Threshold ì¡°ì •](#2-4--inference-prediction-threshold-ì¡°ì •)
  * [2-5. â¬› Black Rectangle ì¶”ê°€](#2-5--black-rectangle-ì¶”ê°€)
  * [2-6. ğŸ§­ Near-Pixel-Diff Loss Term ì¶”ê°€](#2-6--near-pixel-diff-loss-term-ì¶”ê°€)

## 1. TEST RESULT

* dataset : **Kvasir-SEG**
* with **EffiSegNet-B4 (Pre-trained) & 50 epochs** option (instead of 300 epochs option of original paper)
* [Test Result Details](https://github.com/WannaBeSuperteur/AI_Projects/issues/13)

![image](../../images/250522_2.png)

* ê° ëª¨ë¸ ë³„ ë³€ê²½ì  ë° ì„±ëŠ¥

| ëª¨ë¸                  | ë³€ê²½ì    | Test Dice             | Test IoU              | Test Recall           | Test Precision        |
|---------------------|-------|-----------------------|-----------------------|-----------------------|-----------------------|
| Original EffiSegNet |       | 0.9310                | 0.8803                | 0.9363                | 0.9538                |
| 1ì°¨ ìˆ˜ì • (05.24)       | ğŸ“ˆâœ‚   | 0.9406 (â–² 0.0096)     | 0.8913 (â–² 0.0110)     | 0.9259 (â–¼ 0.0104)     | **0.9626 (â–² 0.0088)** |
| 2ì°¨ ìˆ˜ì • (05.24)       | ğŸ“ˆ    | 0.9363 (â–² 0.0053)     | 0.8860 (â–² 0.0057)     | 0.9295 (â–¼ 0.0068)     | 0.9587 (â–² 0.0049)     |
| 3ì°¨ ìˆ˜ì • (05.24)       | âœ‚     | 0.9386 (â–² 0.0076)     | 0.8904 (â–² 0.0101)     | 0.9389 (â–² 0.0026)     | 0.9559 (â–² 0.0021)     |
| 4ì°¨ ìˆ˜ì • (05.24)       | ğŸ“ˆâœ‚ğŸŒ¬ | **0.9421 (â–² 0.0111)** | **0.8944 (â–² 0.0141)** | 0.9385 (â–² 0.0022)     | 0.9590 (â–² 0.0052)     |
| 5ì°¨ ìˆ˜ì • (05.24)       | â¬›     | 0.9370 (â–² 0.0060)     | 0.8879 (â–² 0.0076)     | 0.9378 (â–² 0.0015)     | 0.9568 (â–² 0.0030)     |
| 6ì°¨ ìˆ˜ì • (05.25)       | ğŸ“    | 0.9304 (â–¼ 0.0006)     | 0.8790 (â–¼ 0.0013)     | 0.9295 (â–¼ 0.0068)     | 0.9594 (â–² 0.0056)     |
| 7ì°¨ ìˆ˜ì • (05.25)       | ğŸ§­    | 0.9347 (â–² 0.0037)     | 0.8824 (â–² 0.0021)     | **0.9528 (â–² 0.0165)** | 0.9409 (â–¼ 0.0129)     |
| 8ì°¨ ìˆ˜ì • (05.25)       | â¬›ğŸ§­   | 0.9315 (â–² 0.0005)     | 0.8772 (â–¼ 0.0031)     | 0.9501 (â–² 0.0138)     | 0.9366 (â–¼ 0.0172)     |

* ë³€ê²½ì  ì´ëª¨ì§€

| ì´ëª¨ì§€ | ë³€ê²½ì                                                        |
|-----|-----------------------------------------------------------|
| ğŸ“ˆ  | ColorJitter Prob. 0.5 â†’ 0.8<br>Affine Prob. 0.5 â†’ 0.8     |
| âœ‚   | ElasticTransform Augmentation ì œê±°                          |
| ğŸŒ¬  | ColorJitter Augmentation ê°•ë„ ì•½í™”                            |
| â¬›   | ì´ë¯¸ì§€ì˜ ì¢Œì¸¡ ìƒë‹¨ì— ê²€ì€ìƒ‰ ì§ì‚¬ê°í˜• ì¶”ê°€                                   |
| ğŸ“  | Inference ì‹œ, Prediction Threshold 0.5 â†’ sigmoid(0.5) ë¡œ ì¡°ì • |
| ğŸ§­  | Near-Pixel-Diff Loss Term ì¶”ê°€                              |

## 2. ë³€ê²½ì  ìƒì„¸

### 2-1. ğŸ“ˆ ColorJitter & Affine Prob ìƒí–¥

![image](../../images/250522_3.png)

* ColorJitter, Affine Augmentation ì€ **ì •í•´ì§„ "ì—°ì†ì ì¸ ë³€í˜• ê°•ë„" ë²”ìœ„ ë‚´ì—ì„œ ë‹¤ì–‘í•œ ê²½ìš°ì˜ ìˆ˜ë¡œ ë³€í˜•ì´ ê°€ëŠ¥í•œ Augmentation ì„**
  * Horizontal / Vertical Flip ì²˜ëŸ¼ **ê²½ìš°ì˜ ìˆ˜ê°€ "ì´ì‚°ì ìœ¼ë¡œ" ì •í•´ì§„ ê²ƒì´ ì•„ë‹˜**
* ë”°ë¼ì„œ, í•´ë‹¹ Augmentation ì€ **50% í™•ë¥ ë¡œ ì ìš© ì‹œ ì´ë¯¸ì§€ì˜ ë‹¤ì–‘ì„±ì´ ë–¨ì–´ì§€ê³ , 80% ~ 90% ì •ë„ë¡œ ì ìš© í™•ë¥ ì„ ë†’ì—¬ì•¼** Augmentation ìœ¼ë¡œ ë‹¤ì–‘í•œ ì´ë¯¸ì§€ê°€ ìƒì„±ë¨
* [ì°¸ê³ ](https://github.com/WannaBeSuperteur/AI-study/blob/main/Image%20Processing/Basics_Image_Augmentation_Methods.md#2-torchvision-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-augmentation)

### 2-2. âœ‚ Remove ElasticTransform

* [demo](https://huggingface.co/spaces/qubvel-hf/albumentations-demo) ì—ì„œ í…ŒìŠ¤íŠ¸ ê²°ê³¼, í•´ë‹¹ Transformation ì„ **ë…¼ë¬¸ ì½”ë“œì˜ ì˜µì…˜ì— ë”°ë¥¸ arguments ë¥¼ ì´ìš©í•˜ì—¬** ì ìš© ì‹œ ì´ë¯¸ì§€ê°€ ë¯¸ ì ìš© ì‹œ ì´ë¯¸ì§€ì™€ **ê±°ì˜ ì°¨ì´ ì—†ìŒ**
* ë”°ë¼ì„œ Augmentation ì‹œê°„ë§Œ ëŠ˜ë¦¬ëŠ” **ë¶ˆí•„ìš”í•œ Augmentation ìœ¼ë¡œ íŒë‹¨**

### 2-3. ğŸŒ¬ Weaken ColorJitter

* ColorJitter ì˜ ê°•ë„ë¥¼ ì•½í™”ì‹œì¼œì„œ **ê¸°ì¡´ í•™ìŠµ ë°ì´í„°ì˜ ìƒ‰ìƒ/ì±„ë„/ë°ê¸°ì™€ í° ì°¨ì´ê°€ ì—†ëŠ” ìƒ‰ìƒ/ì±„ë„/ë°ê¸°ì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±** í•˜ë„ë¡ í•¨
* ìƒì„¸ ë‚´ìš©

| Augmentation ëŒ€ìƒ  | ê¸°ì¡´                     | ì¡°ì •                     | ë¹„êµ                                    |
|------------------|------------------------|------------------------|---------------------------------------|
| ```brightness``` | ì›ë˜ ë°ê¸°ì˜ **0.6 - 1.6 ë°°** | ì›ë˜ ë°ê¸°ì˜ **0.8 - 1.4 ë°°** | top cutoff -0.2<br>bottom cutoff +0.2 |
| ```contrast```   | factor ê°’ = **0.2**     | factor ê°’ = **0.15**    | factor ê°’ 25% ê°ì†Œ                       |
| ```saturation``` | factor ê°’ = **0.1**     | factor ê°’ = **0.075**   | factor ê°’ 25% ê°ì†Œ                       |

### 2-4. ğŸ“ Inference Prediction Threshold ì¡°ì •

![image](../../images/250522_6.png)

* sigmoid í•¨ìˆ˜ ì ìš© ì „ì˜ ê° í”½ì…€ ë³„ score ê°’ì— ëŒ€í•œ segmentation threshold ë¥¼ 0.0 â†’ 0.5 ë¡œ **ìƒí–¥ ì¡°ì •**
  * sigmoid ì ìš© í›„ ê¸°ì¤€ threshold ëŠ” **0.5 â†’ sigmoid(0.5) = 0.622** ë¡œ ìƒí–¥ ì¡°ì •ë¨
* ì˜ˆìƒëŒ€ë¡œ recall ê°ì†Œ, precision ì¦ê°€í•¨

| Test Recall       | Test Precision    |
|-------------------|-------------------|
| 0.9295 (â–¼ 0.0068) | 0.9594 (â–² 0.0056) |

### 2-5. â¬› Black Rectangle ì¶”ê°€

![image](../../images/250522_4.png)

* **ë³¸ ë°ì´í„°ì…‹ (Kvasir-SEG) íŠ¹í™”** Augmentation
* ì ìš© ë°°ê²½
  * ë³¸ ë°ì´í„°ì…‹ì˜ ê²½ìš°, ìƒë‹¹ìˆ˜ì˜ ì´ë¯¸ì§€ê°€ ì¢Œì¸¡ í•˜ë‹¨ì— ê²€ì€ ì§ì‚¬ê°í˜•ì´ ìˆìŒ
  * ì´ë¡œ ì¸í•´ **ì¢…ì–‘ì— í•´ë‹¹í•˜ëŠ” ì˜ì—­ì„ ì •í™•íˆ íƒì§€í•˜ëŠ” ë° ì§€ì¥** ì´ ìƒê¸¸ ìˆ˜ ìˆìŒ
  * ë”°ë¼ì„œ, **í•™ìŠµ ë°ì´í„°ì— ì˜ë„ì ìœ¼ë¡œ ë¹„ìŠ·í•œ í¬ê¸°ì˜ ê²€ì€ ì§ì‚¬ê°í˜•ì„ ì¶”ê°€** í•˜ì—¬, **ê²€ì€ ì§ì‚¬ê°í˜•ìœ¼ë¡œ ì¸í•´ í•™ìŠµì— ì§€ì¥ì´ ìƒê¸¸ ë•Œë„ ì¢…ì–‘ ì˜ì—­ì„ ì •í™•íˆ íƒì§€** í•˜ë„ë¡ ëª¨ë¸ í›ˆë ¨
* ìƒì„¸ ì ìš© ì‚¬í•­
  * Augmentation transform ì ìš© ì´ì „ì˜ **ì›ë³¸ ì´ë¯¸ì§€** ì— ëŒ€í•´, 
  * **50%** í™•ë¥ ë¡œ,
  * ì´ë¯¸ì§€ì˜ **ì¢Œì¸¡ ìƒë‹¨** ì— **ê°€ë¡œ, ì„¸ë¡œ ê¸¸ì´ì˜ ê°ê° 30% ì— í•´ë‹¹í•˜ëŠ” í¬ê¸°** ì˜ ê²€ì€ ì§ì‚¬ê°í˜• ì¶”ê°€

### 2-6. ğŸ§­ Near-Pixel-Diff Loss Term ì¶”ê°€

![image](../../images/250522_5.png)

* ì ìš© ë°°ê²½
  * Segmentation ê²°ê³¼ë¡œ ìƒì„±ëœ Segmentation score map ì—ì„œ ìœ„ì™€ ê°™ì´ **ì¢…ì–‘ì˜ ê²½ê³„ì„  ë¶€ë¶„ì— noise ê°€ ë°œìƒ**
  * ì´ë¡œ ì¸í•´ ëª¨ë¸ ì˜ˆì¸¡ì˜ ì •í™•ë„ê°€ ë‹¤ì†Œ ë–¨ì–´ì§
  * ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, **ê°€ë¡œ/ì„¸ë¡œ/ëŒ€ê°ì„ ìœ¼ë¡œ ì¼ì • ê±°ë¦¬ë§Œí¼ ë–¨ì–´ì§„ í”½ì…€ì˜ Segmentation score ì˜ ì°¨ì´ì˜ ì œê³±** ì„ Loss Term ìœ¼ë¡œ ì¶”ê°€
* ìƒì„¸ ì ìš© ì‚¬í•­
  * Loss ê³„ì‚° ë°©ë²•
    * ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´, **ê° í”½ì…€ ë³„ ê°€ë¡œ/ì„¸ë¡œ/ëŒ€ê°ì„ ìœ¼ë¡œ 4 í”½ì…€ ë–¨ì–´ì§„ í”½ì…€ê³¼ì˜ Segmentation score ê°’ ì°¨ì´ì˜ ì œê³±** ì˜ í•©ì˜ í‰ê· ì„ ì´ìš©  
  * ê¸°ì¡´ Loss
    * 1.0 * ```Dice Loss``` + 1.0 * ```Cross-Entropy Loss```
  * ë³€ê²½ Loss
    * 1.0 * ```Dice Loss``` + 1.0 * ```Cross-Entropy Loss``` **+ 0.01 * ```Near-Pixel-Diff Loss```**